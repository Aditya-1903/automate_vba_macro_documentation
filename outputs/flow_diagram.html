<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Interactive D3.js Flow Diagram</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
      const nodes = [
        { id: "main" },
        { id: "init" },
        { id: "setupEnvironment" },
        { id: "loadData" },
        { id: "fetchFromDatabase" },
        { id: "readFromFile" },
        { id: "processData" },
        { id: "transformData" },
        { id: "analyzeData" },
        { id: "generateReport" },
        { id: "finalize" },
        { id: "saveResults" },
        { id: "cleanup" },
      ];

      const links = [
        { source: "main", target: "init" },
        { source: "main", target: "processData" },
        { source: "main", target: "finalize" },
        { source: "init", target: "setupEnvironment" },
        { source: "init", target: "loadData" },
        { source: "loadData", target: "fetchFromDatabase" },
        { source: "loadData", target: "readFromFile" },
        { source: "processData", target: "transformData" },
        { source: "processData", target: "analyzeData" },
        { source: "analyzeData", target: "generateReport" },
        { source: "finalize", target: "saveResults" },
        { source: "finalize", target: "cleanup" },
      ];
    </script>
    <style>
      body {
        background-color: #f9f7f7;
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      header {
        background-color: #3f72af;
        color: #fff;
        text-align: center;
        padding: 20px 0;
        font-size: 24px;
        font-weight: bold;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .node rect {
        fill: #dbe2ef;
        stroke: #3f72af;
        stroke-width: 2px;
        rx: 10;
        ry: 10;
      }
      .node text {
        fill: #112d4e;
        font: 14px sans-serif;
        text-anchor: middle;
      }
      .link {
        fill: none;
        stroke: #3f72af;
        stroke-opacity: 0.6;
        stroke-width: 2px;
      }
      .link.arrowhead {
        marker-end: url(#arrowhead);
      }
      .flowing {
        stroke-dasharray: 5, 5;
        stroke-dashoffset: 0;
        animation: dash 0.5s linear infinite;
      }
      @keyframes dash {
        to {
          stroke-dashoffset: -10;
        }
      }
    </style>
  </head>
  <body>
    <header>Automated Process Flow Visualization</header>
    <svg width="100%" height="600"></svg>
    <script>
      const width = window.innerWidth;
      const height = 600; // Adjust as needed

      const svg = d3.select("svg").attr("width", width).attr("height", height);

      const simulation = d3
        .forceSimulation(nodes)
        .force(
          "link",
          d3
            .forceLink(links)
            .id((d) => d.id)
            .distance(150)
        )
        .force("charge", d3.forceManyBody().strength(-300))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collide", d3.forceCollide().radius(80).iterations(2));

      svg
        .append("defs")
        .append("marker")
        .attr("id", "arrowhead")
        .attr("viewBox", "-0 -5 10 10")
        .attr("refX", 13)
        .attr("refY", 0)
        .attr("orient", "auto")
        .attr("markerWidth", 13)
        .attr("markerHeight", 13)
        .attr("xoverflow", "visible")
        .append("svg:path")
        .attr("d", "M 0,-5 L 10 ,0 L 0,5")
        .attr("fill", "#3f72af")
        .style("stroke", "none");

      const link = svg
        .append("g")
        .selectAll("path")
        .data(links)
        .enter()
        .append("path")
        .attr("class", "link arrowhead flowing");

      const node = svg
        .append("g")
        .selectAll("g")
        .data(nodes)
        .enter()
        .append("g")
        .attr("class", "node")
        .call(
          d3
            .drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended)
        );

      node
        .append("rect")
        .attr("width", function (d) {
          return d.id.length * 10 + 20;
        })
        .attr("height", 30)
        .attr("x", function (d) {
          return -((d.id.length * 10 + 20) / 2);
        })
        .attr("y", -15);

      node
        .append("text")
        .attr("dy", 5)
        .text((d) => d.id);

      simulation.on("tick", () => {
        link.attr("d", (d) => {
          const dx = d.target.x - d.source.x;
          const dy = d.target.y - d.source.y;
          const dr = Math.sqrt(dx * dx + dy * dy);
          return `M${d.source.x},${d.source.y}A${dr},${dr} 0 0,1 ${d.target.x},${d.target.y}`;
        });

        node.attr("transform", (d) => `translate(${d.x},${d.y})`);
      });

      function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }

      function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
      }

      function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
      }
    </script>
  </body>
</html>
